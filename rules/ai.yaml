# @import data from '../../data/chat.json'
# chat comment with quality filtering
- id: rule-id
  on: chat
  if:
    operator: AND
    conditions:
      # Compara el último guardado (limpio) con el actual limpio
      - field: ${globals.clean(data.comment)}
        operator: NEQ
        value: ${globals.clean(globals.last())}

      # Evita mensajes vacíos después de limpiar
      - field: ${globals.clean(data.comment)}
        operator: NOT_IN
        value: ["", null, undefined]
      
      # si es un comentario corto
      - field: ${globals.clean(data.comment).length}
        operator: GT
        value: 3

      - field: ${data.comment}
        #this value is a command to trigger the ai
        operator: CONTAINS
        value: ["!ia","!ai"]
  do:
    mode: SEQUENCE
    actions:
      - type: AI_RESPOND
        params:
          prompt: ${data.comment}
      - type: log
        params:
          message: "AI response: ${data.comment}"
