# @import data from '../../data/chat.json'
# Chat comment rule - TTS processing with quality filtering
# Quality filter configuration is in plugins/ai/constants.ts
- id: rule-id
  on: chat
  if:
    operator: AND
    conditions:
      # Evita duplicados: compara el último mensaje con el actual
      - field: ${globals.clean(data.comment)}
        operator: NEQ
        value: ${globals.clean(globals.last())}

      # Evita mensajes vacíos después de limpiar
      - field: ${globals.clean(data.comment)}
        operator: NOT_IN
        value: ["", null, undefined]
      
      # Longitud mínima para procesar
      - field: ${globals.clean(data.comment).length}
        operator: GT
        value: 3

      # Quality filter - skips gibberish, repetitive patterns, etc.
      # See: plugins/ai/constants.ts for configuration
      - field: ${data.comment}
        operator: NOT_IN
        value: ["!ia","!ai"]
  do:
    mode: SEQUENCE
    actions:
      - type: TTS
        params:
          message: ${data.comment}